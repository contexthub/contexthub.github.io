---
title: Contextual Engine
layout: default
---

# Contextual Engine
{: #contextual-engine}

The contextual engine is the center of ContextHub, adding dynamic capabilities to events generated by your apps through context rules. The contextual engine aims to solve the problem of allowing developers to change how their app behaves based on events generated by a device to create a more seamless experience for end users. Through events, feeds, and context rules, you'll be able to build more quickly modern, contextually-aware applications your users will enjoy.

Context rules are written in javascript. There are a few pre-existing objects that you can interact with when one of your context rules executes --


<a data-magellan-destination="beacon" name="beacon"></a>

## Beacon

Beacons are Bluetooth 4.0 Low Energy devices that allow devices to detect proximity to objects within 50 meters. This gives you the ability to give context-sensitive information to your users in areas where GPS, WiFi, and cellular towers cannot pinpoint a user's exact location, such as deep inside buildings or underground. Here's how to use the *beacon* object to interact with beacons in a context rule:

### beacon properties

| Property  | Description |
|-----------|-------------|
| uuid      | Generates a random uuid every time this propery is accessed. You should store the value of this property in a variable if you need to use the same uuid in multiple places. |

### beacon methods

| Method    | Description |
|-----------|-------------|
| [create](#beacon-create)    | Creates a new beacon in ContextHub |
| [find](#beacon-find)      | Finds a beacon by id |
| [allTagged](#beacon-alltagged) | Finds beacons matching **all** of the given tags |
| [anyTagged](#beacon-anytagged) | Finds beacons matching **any** of the given tags |
| [update](#beacon-update)    | Updates an existing beacon with new information  |
| [destroy](#beacon-destroy)   | Deletes a beacon from the system |


<a name="beacon-create" data-magellan-destination="beacon-create"></a>

---

#### Create

Creating a beacon contextual element in ContextHub is simple. Every beacon has a UUID (32 digit hexadecimal character, a major value (ranging from 1-65535), and a minor value (also ranging from 1-65535). UUIDs you use should be unique so beacons from other user's do not interfere with your app. A combination of these three values should be unique for every beacon you have.

##### Syntax
`beacon.create(tags, name, uuid, major, minor)`

##### Parameter Values

| Parameter    | Description |
|--------------|-------------|
| tags         | Required. A comma separated string of tags to associate with the beacon. If you don't want to tag the beacon, you can pass in null or "".|
| name         | Required. The name of the beacon |
| uuid         | Required. The uuid of the beacon. |
| major        | Optional. The major number for this beacon. |
| minor        | Optional. The minor number for this beacon. |

##### Return Value
The id of the newly created beacon.

##### Example
{% gist CHLibrarian/9c62b626473a434dfc5b %}

<a name="beacon-find" data-magellan-destination="beacon-find"></a>

---

#### Find
Retrieve a specific beacon from ContextHub by passing a beacon ID.

##### Syntax
`beacon.find(id)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| id        | Required. The id of the beacon you want to retrieve. |

##### Return Value
A beacon object.
{% gist CHLibrarian/13d02a106b74289d1dc3 %}


##### Example
{% gist CHLibrarian/494e611bd57f6d0d8863 %}

<a name="beacon-alltagged" data-magellan-destination="beacon-alltagged"></a>

---

#### All Tagged
Retrieves a group of beacons from ContextHub. Adding more tags seperated by commas to the same function call filters only beacons that have *all* tags on the same beacon.

##### Syntax
`beacon.allTagged(tags)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| tags      | Required. A string containing the tag(s) to search for. Multiple tags can be searched for by separating them with commas. Results will contain beacons that match **all** the specified tags. |

##### Return Value
An array of beacon objects.
{% gist CHLibrarian/02f5dd4bdc9ea708d52d %}


##### Example
{% gist CHLibrarian/1bc45aa1d2b7008fa6f2 %}


<a name="beacon-anytagged" data-magellan-destination="beacon-anytagged"></a>

---

#### Any Tagged
Retrieves a group of beacons from ContextHub. This function returns beacons that match *any* of the given tags.

##### Syntax
`beacon.anyTagged(tags)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| tags      | Required. A string containing the tag(s) to search for. Multiple tags can be searched for by separating them with commas. Results will contain beacons that match **any** of the specified tags. |

##### Return Value
An array of beacon objects.
{% gist CHLibrarian/02f5dd4bdc9ea708d52d %}


##### Example
{% gist CHLibrarian/8de11d7ba0cf2a1763bd %}

<a  name="beacon-update" data-magellan-destination="beacon-update"></a>

---

#### Update
Updates an existing beacon.

##### Syntax
`beacon.update(id, data, tags)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| id        | Required. The id of the beacon you wish to update. |
| data      | Required. Stringified JSON of the beacon attributes that you want updated. |
| tags      | Optional. A string containing the tag(s) to assign to the beacon. Multiple tags can be assigned by separating them with commas. |

##### Return Value
Nothing.

##### Example
{% gist CHLibrarian/84a08b4677d54937dc81 %}

<a name="beacon-destroy" data-magellan-destination="beacon-destroy"></a>

---

#### Destroy
Destroying a beacon only requires passing the id of the *beacon* object. The beacon is deleted from ContextHub.

##### Syntax
`beacon.destroy(id)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| id        | Required. The id of the beacon you want to delete. |

##### Return Value
Nothing.

##### Example
{% gist CHLibrarian/6bb47bccf63793f6864c %}

<a name="console" data-magellan-destination="console"></a>

---

## Console
The *console* object allows you to log activity inside your context rule.

### Console Methods

| Method    | Description |
|-----------|-------------|
| [log](#console-log)   | Makes a http GET request to the specified url. |

<a name="console-log" data-magellan-destination="console-log"></a>

---

#### Log

Logs the message to the console. You can see the logs from the *Logs* screen in the [developer portal](https://app.contexthub.com).

##### Syntax
`console.log(message)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| message   | Required. Message to log to the console. |

##### Return Value
Nothing.

##### Example
{% gist CHLibrarian/25f12ebc450a8dba7027 %}

<a name="device" data-magellan-destination="device"></a>

---

## Device
The *device* object you allows to find devices in your application.

### Device Properties

| Property  | Description |
|-----------|-------------|
| triggeringDevice | The device that triggered the event in this context rule. This can be `null` if the event originated from a trigger and not a device. |

###  Device Methods

| Method                             | Description                                       |
|------------------------------------|---------------------------------------------------|
| [findByAlias](#device-findbyalias) | Finds devices by their alias.                     |
| [findById](#device-findbyid)       | Finds devices by their device id.                 |
| [allTagged](#device-alltagged)     | Finds devices matching **all** of the given tags. |
| [anyTagged](#device-anytagged)     | Finds devices matching **any** of the given tags. |
| [near](#device-near)               | Finds devices near a location                     |
| [setTags](#device-settags)         | Replaces a device's tags with the given tag list  |
| [addTags](#device-addtags)         | Adds tags to a device                             |
| [removeTags](#device-removetags)   | Removes tags from a device                        |

<a name="device-findbyalias" data-magellan-destination="device-findbyalias"></a>

---

#### Find By Alias
Finds devices by their alias.

##### Syntax
`device.findByAlias(alias,...,aliasN)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| alias     | Required. One or more aliases to find. |

##### Return Value
Array of device objects.
{% gist CHLibrarian/1754b5904fbe118ebbee %}

##### Example
{% gist CHLibrarian/324803e628f6f651eaad %}

<a name="device-findbyid" data-magellan-destination="device-findbyid"></a>

---

#### Find By Id
Finds devices by their device id.

##### Syntax
`device.findById(id,...,idN)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| id        | Required. One or more ids to find. |

##### Return Value
Array of device objects.
{% gist CHLibrarian/1754b5904fbe118ebbee %}

##### Example
{% gist CHLibrarian/324803e628f6f651eaad %}

<a name="device-alltagged" data-magellan-destination="device-alltagged"></a>

---

#### All Tagged
Finds devices by tags. Adding more tags seperated by commas to the same function call filters only devices that have *all* tags on the same device.

##### Syntax
`device.allTagged(tags)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| tags      | Required. A string containing the tag(s) to search for. Multiple tags can be searched for by separating them with commas. Results will contain devices that match **all** the specified tags. |

##### Return Value
Array of device objects.
{% gist CHLibrarian/1754b5904fbe118ebbee %}

##### Example
{% gist CHLibrarian/324803e628f6f651eaad %}


<a name="device-anytagged" data-magellan-destination="device-anytagged"></a>

---

#### Any Tagged
Finds devices by tags. This function returns devices that match *any* of the given tags.

##### Syntax
`device.anyTagged(tags)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| tags      | Required. A string containing the tag(s) to search for. Multiple tags can be searched for by separating them with commas. Results will contain devices that match **any** of the specified tags. |

##### Return Value
Array of device objects.
{% gist CHLibrarian/1754b5904fbe118ebbee %}

##### Example
{% gist CHLibrarian/324803e628f6f651eaad %}

<a name="device-near" data-magellan-destination="device-near"></a>

---

#### Near
Finds devices near a location.

##### Syntax
`device.near(latitude, longitude, radius)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| latitude  | Required. The latitude of the position you want to find devices near.  |
| longitude | Required. The longitude of the position you want to find devices near. |
| radius    | Required. The radius *(in meters)* from the position you want to find devices near.  |

##### Return Value
Array of device objects.
{% gist CHLibrarian/1754b5904fbe118ebbee %}

##### Example
{% gist CHLibrarian/324803e628f6f651eaad %}

<a name="device-settags" data-magellan-destination="device-settags"></a>

---

#### Set Tags
Replaces a device's tags with the given tag list.

##### Syntax
`device.setTags(device_id, tag1, .., tagN)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| device_id | Required. The device id of the device whose tags will be replaced. |
| tag1,..,tagN | Required. The tags that will replace the current tag list. Each tag should be its own parameter. If you wish to remove all tags, set the tag parameter to be _null_. |

##### Return Value
Boolean. True if the operation was successfull, false otherwise.

##### Example
{% gist CHLibrarian/2370ca019fa378246f90 %}

<a name="device-addtags" data-magellan-destination="device-addtags"></a>

---

#### Add Tags
Adds additional tags to the given device.

##### Syntax
`device.addTags(device_id, tag1, .., tagN)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| device_id | Required. The device id of the device to add tags to. |
| tag1,..,tagN | Required. The tags that will be added the current tag list. Each tag should be its own parameter. |

##### Return Value
Boolean. True if the operation was successfull, false otherwise.

##### Example
{% gist CHLibrarian/2370ca019fa378246f90 %}

<a name="device-removetags" data-magellan-destination="device-removetags"></a>

---

#### Remove Tags
Removes tags from the given device.

##### Syntax
`device.removeTags(device_id, tag1, .., tagN)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| device_id | Required. The device id of the device to remove tags from. |
| tag1,..,tagN | Required. The tags that will be removed the device. Each tag should be its own parameter. |

##### Return Value
Boolean. True if the operation was successfull, false otherwise.

##### Example
{% gist CHLibrarian/2370ca019fa378246f90 %}

<a name="event" data-magellan-destination="event"></a>

---

##EVENT
Sensors in modern devices generate a lot of data which ContextHub packages today into an event. The `event` object contains the event that triggered the execution of the context rule. The `event` object is readonly and contains the following properties:

| Property   | Description |
|------------|-------------|
| name       | The name of the event. This matches the event type of the context rule. |
| data       | The data object contains all the properties relevant to this event type. See below for specific structures. |
| context    | The context object contains all information known about the device at the time the event was created. |
| payload    | Developer-defined custom data sent along with every event generated by the ContextHub SDK. |
| id         | A unique identifier for this event. |
| created_at | An ISO8601 timestamp of when the event was received by the server. |


<a name="event-sampleevent" data-magellan-destination="event-sampleevent"></a>

###Sample Event

Here is the structure of a sample event:
{% gist CHLibrarian/18c01d70d2448bfec465 %}

<a name="event-beaconinout" data-magellan-destination="event-beaconinout"></a>

###Beacon In/Out

The `beacon_in`/`beacon_out` event is generated whenever a device enters or exits a beacon region. A beacon region is defined as a UUID + major/minor values, if provided. If not provided, then several beacons having the same UUID will only trigger a `beacon_in` event once. Inside the `data` key, there is a `beacon` key indicating the beacon region which was just entered/exited and the UUID for the beacon region. Major and minor values will be filled only if the monitored region in ContextHub has them (they are not required). To get events about specific beacons, specifically `state` and `accuracy` values, look at `beacon_changed`.

{% gist CHLibrarian/4124b79edcc0e6969f8d %}

<a name="event-beaconchanged" data-magellan-destination="event-beaconchanged"></a>

### Beacon Changed

The `beacon_changed` event is generated whenever a device changes proximity of a *specific* beacon. There are three pre-defined states, `immediate_state`, `near_state`, and `far_state` which are approximately 0-6 inches, 6-12 inches, and 12 inches - 50 feet depending on the range and power setting of the particular beacon used. Within the `beacon` key of the `data` key, you will find the specific `major` and `minor` values of the beacon, as well as the `rssi` value giving relative strength. Estimote explains very well [here](https://community.estimote.com/hc/en-us/articles/201029223-RSSI-Range-Zones-and-Distance-Accuracy) RSSI values and how they relate to distance between a device an a beacon. `accuracy` is also another key present which gives the approximate distance from the beacon to the device. Given the number of factors that influence wireless signals in an area, the accuracy value should be used as a general guideline, and not relied on in critical scenarios.

{% gist CHLibrarian/4768b16d3e6a1b95785d %}

<a name="event-geofenceinout" data-magellan-destination="event-geofenceinout"></a>

###Geofence In/Out

The `geofence_in`/`geofence_out` is generated whenever a device enters or exists a circular geofence region. A geofence region is defined as a geospatial center with latitude and longitude, and radius in meters. Inside the `data` key, there is a `fence` key indicating the geofence region which was just entered/exited along with the latitude, longitude, and radius of the geofence. The `state` key determines whether the event was a `geofence_in` or `geofence_out` event.
{% gist CHLibrarian/9d4439ed9ed94720514f %}


<a name="event-locationchanged" data-magellan-destination="event-locationchanged"></a>

###Location Changed

The `location_changed` event is generated whenever a device has a significant location change as defined by the platform. For iOS, this is approximately once every 1000 meters, depending on WiFi/cellular tower density and GPS availability. The `data` structure contains keys related to the `latitude`, `longitude`, `speed`, `altitude`, and `course` of the device at the time the event was generated.

{% gist CHLibrarian/33148acb910e8c3c31d2 %}

<!--
###Motion Changed

The `motion_changed` event is generated whenever an iOS device with the M7 chip transitions between various states representing different modes of transportation: `stationary`, `walking`, `running`, and `driving`. The `data` key contains two keys (`current_activity` and `previous_activity`) representing the current and previous activities respectively along with a `start_date` timestamp and `confidence` key representing how confident the M7 is that the state of the activity is accurate.

{% gist CHLibrarian/ea17579eb481ac658a36 %}
<br />
-->


<a name="event-tick" data-magellan-destination="event-tick"></a>

### Tick

The `tick` event is a special event that is automatically executed once every minute in the ContextHub server. Using the JavaScript `Date()` object and checking the time, this allows you the ability to execute commands in ContextHub even with the *absence* of any events on the server. So instead of your server code simply being reactive to devices, it can be a proactive part of your applications.

{% gist CHLibrarian/109cad3805c2650fe9f0 %}

<a name="event-customevents" data-magellan-destination="event-customevents"></a>

###Custom Events

Custom events are events triggered by the developer that have no predefined data structure. These events are manually triggered by the SDK through a specific method, or by posting an event through a feed for web browsers, servers, JavaScript scripts, and IoT-like devices like the Raspberry Pi or Arduino. All custom events must have a defined `name` key, so they can be processed by the appropriate context rule if it exists and should have the `data` key representing your custom data structure. Custom events generated by non-SDK devices, will not have either the `context` or `payload` unless they are defined by you, the application developer.

<p class="p-indent-30">Below is a sample of a data structure of a custom event, taken from the [Awareness](/samples/ios/awareness) context rule sample app.</p>

{% gist CHLibrarian/57a43d174de887c0b778 %}


<a name="geofence" data-magellan-destination="geofence"></a>

---

## Geofence

Geofences are pre-defined areas of interest that allow your application to be notified when a device has entered or exited that region. Here's how to use the *geofence* object to interact with geofences:

### geofence methods

| Method    | Description |
|-----------|-------------|
| [create](#geofence-create)    | Creates a new geofence in ContextHub |
| [find](#geofence-find)      | Finds a geofence by id |
| [allTagged](#geofence-alltagged) | Finds geofences matching **all** of the given tags |
| [anyTagged](#geofence-anytagged) | Finds geofences matching **any** of the given tags |
| [search](#geofence-search) | Finds geofences within the geographical area |
| [update](#geofence-update)    | Updates an existing geofence with new information  |
| [destroy](#geofence-destroy)   | Deletes a geofence from the system |

<a name="geofence-create" data-magellan-destination="geofence-create"></a>

---

#### Create

Creating a geofence contextual element in ContextHub is simple. Every geofence is defined by a latitude and longitude indicating their center and a radius in meters to create the perimeter.

##### Syntax
`geofence.create(tags, name, latitude, longitude, radius)`

##### Parameter Values

| Parameter    | Description |
|--------------|-------------|
| tags         | Required. A comma separated string of tags to associate with the geofence. If you don't want to tag the geofence, you can pass in null or "".|
| name         | Required. The name of the geofence |
| latitude     | Required. The latitude of the center of the geofence. |
| longitude    | Required. The longitude of the center of the geofence. |
| radius       | Required. The radius *(in meters)* of the geofence. |

##### Return Value
The id of the newly created geofence.

##### Example
{% gist CHLibrarian/10308ee7887765d11b29 %}

<a name="geofence-find" data-magellan-destination="geofence-find"></a>

---

#### Find
Retrieve a specific geofence from ContextHub by passing a geofence ID.

##### Syntax
`geofence.find(id)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| id        | Required. The id of the geofence you want to retrieve. |

##### Return Value
A geofence object.
{% gist CHLibrarian/27c84da6c401fd4e312c %}


##### Example
{% gist CHLibrarian/268b1e9bd2b3e1b157e2 %}

<a name="geofence-alltagged" data-magellan-destination="geofence-alltagged"></a>

---

#### All Tagged
Retrieves a group of geofences from ContextHub. Adding more tags seperated by commas to the same function call filters only geofences that have *all* tags on the same geofence.

##### Syntax
`geofence.allTagged(tags)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| tags      | Required. A string containing the tag(s) to search for. Multiple tags can be searched for by separating them with commas. Results will contain geofences that match **all** the specified tags. |

##### Return Value
An array of geofence objects.
{% gist CHLibrarian/5af2bae24ae1156fea82 %}


##### Example
{% gist CHLibrarian/4ed014db0c57e58fd3a2 %}


<a name="geofence-anytagged" data-magellan-destination="geofence-anytagged"></a>

---

#### Any Tagged
Retrieves a group of geofences from ContextHub. This function returns geofences that match *any* of the given tags.

##### Syntax
`geofence.anyTagged(tags)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| tags      | Required. A string containing the tag(s) to search for. Multiple tags can be searched for by separating them with commas. Results will contain geofences that match **any** of the specified tags. |

##### Return Value
An array of geofence objects.
{% gist CHLibrarian/5af2bae24ae1156fea82 %}


##### Example
{% gist CHLibrarian/58887ef915a15c1f860b %}

<a name="geofence-search" data-magellan-destination="geofence-search"></a>

---

#### Search
Retrieves geofences that are within the specified area.

##### Syntax
`search(latitude, longitude, radius)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| latitude     | Required. The latitude of the center of the search area. |
| longitude    | Required. The longitude of the center of the search area. |
| radius       | Required. The radius *(in meters)* of the search area. |

##### Return Value
An array of geofence objects.
{% gist CHLibrarian/5af2bae24ae1156fea82 %}


##### Example
{% gist CHLibrarian/3331a6470c0dbe4fef27 %}

<a name="geofence-update" data-magellan-destination="geofence-update"></a>

---

#### Update
Updates an existing geofence.

##### Syntax
`geofence.update(id, data, tags)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| id        | Required. The id of the geofence you wish to update. |
| data      | Required. Stringified JSON of the geofence attributes that you want updated. |
| tags      | Optional. A string containing the tag(s) to assign to the geofence. Multiple tags can be assigned by separating them with commas. |

##### Return Value
Nothing.

##### Example
{% gist CHLibrarian/54183962334352202b4c %}

<a name="geofence-destroy" data-magellan-destination="geofence-destroy"></a>

---

#### Destroy
Destroying a geofence only requires passing the id of the *geofence* object. The geofence is deleted from ContextHub.

##### Syntax
`geofence.destroy(id)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| id        | Required. The id of the geofence you want to delete. |

##### Return Value
Nothing.

##### Example
{% gist CHLibrarian/fd892e5fa5075f97f19f %}


<a name="http" data-magellan-destination="http"></a>

---

## HTTP
The *http* object allows you to send http requests to external services in a context rule. This allows you
to send data to external servers when interesting events occur inside ContextHub. You will see the status
of your request in your logs, but you will not be able to do anything with the response.

### http methods

| Method    | Description |
|-----------|-------------|
| [get](#http-get)   | Makes a http GET request to the specified url. |
| [post](#http-post)   | Makes a http POST request to the specified url. |

<a name="http-get" data-magellan-destination="http-get"></a>

---

#### Get

Allows you to perform an http GET request to a specific URL. You can specify optional query parameters and headers with the *params*, and *headers* parameters. These need to be in the form of JSON strings.

##### Syntax
`http.get(url, params, headers)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| url       | Required. The url you are making the request to. |
| params    | Optional. Stringified JSON of any query parameters that you want to include. |
| headers   | Optional. Stringified JSON of any request headers that you want to include. |

##### Return Value
Nothing.

##### Example
{% gist CHLibrarian/9a5e0f673a526ee790a2 %}

<a name="http-post" data-magellan-destination="http-post"></a>

---

#### Post

Allows you to perform an http POST request to a specific URL. You can specify optional headers with the  *headers* parameter. This needs to be in the form of a JSON string.

##### Syntax
`http.get(url, body, headers)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| url       | Required. The url you are making the request to. |
| body      | Optional. The body of the post request. |
| headers   | Optional. Stringified JSON of any request headers that you want to include. |

##### Return Value
Nothing.

##### Example
{% gist CHLibrarian/ae16587c627cf3e8d520 %}

<a name="push" data-magellan-destination="push"></a>

---

## Push

The *push* object allows you to send push notifications across all service platforms *(APNS & GCM)*. By sending notifications to devices with a certain tag, you can send a single notification to IOS and Android devices. Certain APNS keys (alert, badge, sound, category) will be duplicated in the GCM message payload to simplify sending similar messages to different platforms.

When sending notifications to multiple platforms, you need to be mindful of payload size limits:

* IOS 7.1 and lower: 256 bytes
* IOS 8.0 and above: 2048 bytes
* Android: 4096 bytes

### push methods

| Method    | Description |
|-----------|-------------|
| [deliver](#push-deliver) | Sends a push notification to iOS *and/or* Android devices. |

<a name="push-deliver" data-magellan-destination="push-deliver"></a>

---

#### Deliver

Delivers a push notification to one or more devices. There a few ways to determine which devices will receive the notification: *push_tokens*, *device_ids*, *alias*, *tags*. You need to use at least one of those keys to successfully send a notification.

##### Syntax
`push.deliver(jsonString)`

##### Parameter Values

| Parameter  | Description |
|------------|-------------|
| jsonString | Required. Stringified JSON of the push object to send. See the table below to see all the available options. |

| Key | Platform | Type | Description |
|-----|----------|------|-------------|
| push_tokens | APNS/GCM | Array | An array of APNS device tokens and/or GCM registration ids to send a notification to.|
| alias | APNS/GCM | Array | An array of device aliases to send a notification to. |
| device_ids | APNS/GCM | Array | An array device ids to send a notification to. This is the preferred way to send notifications to a single device.|
| tags | APNS/GCM | Array | An array of device tags to send a notification to. This is the preferred way to send notifications to multiple devices. |
| tag_operator | APNS/GCM | String | By default, tag matching will match on _ANY_ of the given tags. If you want to send notifications to devices that match _ALL_ of the given tags, set the tag_operator parameter to ALL. The default value is _ANY_. |
| exclude_device_ids | APNS/GCM | Array | Array of device ids that you want to exclude from delivering a message to. This is handy when sending notifications to tagged devices and want to exclude one or more devices from that group. |
| exclude_push_tokens | APNS/GCM | Array | Array of push tokens that you want to exclude from delivering a message to. This is handy when sending notifications to tagged devices and want to exclude one or more devices from that group. |
| mdm | APNS | String | APNS Mobile Device Management magic key. You most likely don’t want to use this. This is an APNS specific key. |
| priority | APNS | Integer | Sets the APNS priority. Can be either be set to 10 (immediate) or 5 (conserve power). This is an APNS specific key. Defaults to 10. |
| expiry | APNS/GCM | Integer | Identifies when a notification is no longer valid and can be discarded. APNS notifications default to one day. GCM notifications default to 4 weeks. |
| category | APNS | String | Sets the APNS category for push. This key will be added to the GCM data payload if it exists and the data payload does not already contain a category key. |
| url_args | APNS | String | Sets the url-args in the aps section of the APNS payload. This is an APNS specific key used for notifications to web browsers. |
| badge | APNS | Integer | The number to display as the badge of the app icon. If this property is absent, the badge is not changed. To remove the badge, set the value of this property to 0. This key will be added to the GCM data payload if it exists and the data payload does not already contain a badge key. |
| sound | APNS | String | The name of a sound file in the app bundle. The sound in this file is played as an alert. If the sound file doesn’t exist or default is specified as the value, the default alert sound is played. The audio must be in one of the audio data formats that are compatible with system sounds. This key will be added to the GCM data payload if it exists and the data payload does not already contain a sound key. |
| alert | APNS | String or Object | If this property is included, the system displays a standard alert. You may specify a string as the value of alert or a dictionary as its value. If you specify a string, it becomes the message text of an alert with two buttons: Close and View. If the user taps View, the app is launched. Alternatively, you can specify a dictionary as the value of alert. This key will be added to the GCM data payload if it exists and the data payload does not already contain a alert key. |
| content_available | APNS | Integer | Provide this key with a value of 1 to indicate that new content is available. Including this key and value means that when your app is launched in the background or resumed, application:didReceiveRemoteNotification:fetchCompletionHandler: is called. Newsstand apps are guaranteed to be able to receive at least one push with this key per 24-hour window. This is an APNS specific key. |
| collapse_key | GCM | String | A collapse key is an arbitrary string that is used to collapse a group of like messages when the device is offline, so that only the most recent message gets sent to the client. For example, *New mail*, *Updates available*, and so on. GCM allows a maximum of 4 different collapse keys to be used by the GCM server at any given time. If you exceed this number GCM will only keep 4 collapse keys, with no guarantees about which ones they will be. This is an GCM specific key. |
| data | APNS/GCM | Object | For APNS devices, this adds custom keys to the payload data. For GCM devices, this is the message payload. Any valid JSON is acceptable. GCM messages will have the ‘alert’, ‘badge’, ‘sound’, ‘category’ keys added to the payload if they have been set and the keys do not already exist in the payload. |

##### Return Value
Nothing.

##### Example
{% gist CHLibrarian/f5aab36ce20d86828099 %}


<a name="vault" data-magellan-destination="vault"></a>

---

## Vault
The *vault* object provides access to the vault document store.

### vault methods

| Method    | Description |
|-----------|-------------|
| [create](#vault-create)   | Adds a new document to the vault. |
| [find](#vault-find)       | Retreives a document from the vault via id. |
| [allTagged](#vault-alltagged) | Finds vault objects matching **all** of the given tags |
| [anyTagged](#vault-anytagged) | Finds vault objects matching **any** of the given tags |
| [search](#vault-search) | Finds vault objects containing the given term.
| [keyPath](#vault-keypath) | Finds vault objects with the given key path. |
| [update](#vault-update)    | Updates an existing vault object with new information  |
| [destroy](#vault-destroy)   | Deletes a vault object from the system |

<a name="vault-create" data-magellan-destination="vault-create"></a>

---

#### Create
Stores the given json data in the vault with the given tags.

##### Syntax
`vault.create(data, tags)`

##### Parameter Values

| Parameter    | Description |
|--------------|-------------|
| data         | Required. Stringified JSON of the data you want to store in the vault. |
| tags         | Required. A comma separated string of tags to associate with the vault object. If you don't want to tag the vault object, you can pass in null or "".|

##### Return Value
The id of the newly created vault object.

##### Example
{% gist CHLibrarian/a098fd2a92e835982b20 %}

<a name="vault-find" data-magellan-destination="vault-find"></a>

---

#### Find
Retreives a document from the vault via id.

##### Syntax
`vault.find(id)`

##### Parameter Values

| Parameter  | Description |
|------------|-------------|
| id         | Required. The id of the vault object to find. |

##### Return Value
A vault object.
{% gist CHLibrarian/f03d82ad1e2e1c4b5d0c %}

| Property   | Description |
|------------|-------------|
| data       | Your data is stored under the data propery. |
| vault_info | Object containing metadata about the vault object.|

| vault_info Properties | Description |
|-----------------------|-------------|
| **id** | The vault object id. |
| **tags** | Array of tags assigned to the vault object. |
| **created_at** | Timestamp of when the object was created. |
| **updated_at** | Timestamp of when the object was last updated. |
| **tag_string** | Tags as a comma separated string |

##### Example
{% gist CHLibrarian/08e7a097a018ae13b8b2 %}

<a name="vault-alltagged" data-magellan-destination="vault-alltagged"></a>

---

#### All Tagged
Finds vault objects that contain *all* the specified tags.

##### Syntax
`vault.allTagged(tags)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| tags      | Required. A string containing the tag(s) to search for. Multiple tags can be searched for by separating them with commas. Results will contain vault objects that match **all** the specified tags. |

##### Return Value
An array of vault objects.
{% gist CHLibrarian/a9409c08102b01815250 %}

##### Example
{% gist CHLibrarian/f95de5fabe8af80431ce %}

<a name="vault-anytagged" data-magellan-destination="vault-anytagged"></a>

---

#### Any Tagged
Finds vault objects that contain *any* of the specified tags.

##### Syntax
`vault.anyTagged(tags)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| tags      | Required. A string containing the tag(s) to search for. Multiple tags can be searched for by separating them with commas. Results will contain vault objects that match **any** the specified tags. |

##### Return Value
An array of vault objects.
{% gist CHLibrarian/a9409c08102b01815250 %}

##### Example
{% gist CHLibrarian/f95de5fabe8af80431ce %}

---

<a name="vault-search" data-magellan-destination="vault-search"></a>

#### Search
Finds all vault objects that contain the given term. You can use the following search operators in your queries to fine tune your results. You can use parentheses to set operator precedence.

| Operator | Example |
|----------|---------|
| **Not**  | !term   |
| **And**  | term1 & term2 |
| **Or**   | term1 \| term2 |

##### Syntax
`vault.search(term)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| term      | Required. A string containing the term to search for. Any documents containing the term will be returned. |

##### Return Value
An array of vault objects.
{% gist CHLibrarian/a9409c08102b01815250 %}

##### Example
{% gist CHLibrarian/ccd10b6bf887a37037fc %}

<a name="vault-keypath" data-magellan-destination="vault-keypath"></a>

---

#### KeyPath
Finds all vault objects that have the specified key path. If a value is provided, then documents that have the value
at the key path will be returned.

##### Syntax
`vault.keyPath(key, value)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| key       | Required. A string containing the key to search for. Use dot notation *'address.city'* for specifying a nested key. |
| value     | Optional. If provided documents that match the value at the key will be returned. Otherwise, all documents that contain the key will be returned. |

##### Return Value
An array of vault objects.
{% gist CHLibrarian/a9409c08102b01815250 %}

##### Example
{% gist CHLibrarian/833335fce9bb9e522407 %}

<a name="vault-update" data-magellan-destination="vault-update"></a>

---

#### Update
Replaces the vault object at the given id with the given data.

##### Syntax
`vault.update(id, data, tags = nil)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| id        | Required. The id of the vault object to update. |
| data      | Required. Stringified JSON of the data you want to store in the vault. |
| tags      | Optional. A comma separated string of tags to associate with the vault object. If you don't want to update the tags, you can omit this parameter. |

##### Return Value
Nothing.

##### Example
{% gist CHLibrarian/cd7dc04e6624ebbc35e2 %}

<a name="vault-destroy" data-magellan-destination="vault-destroy"></a>

#### Destroy
Deleting a vault items only requires passing the id to the *vault* object. The vault item is deleted from ContextHub.

##### Syntax
`vault.destroy(id)`

##### Parameter Values

| Parameter | Description |
|-----------|-------------|
| id        | Required. The id of the vault object to delete. |

##### Return Value
Nothing.

##### Example
{% gist CHLibrarian/a55f094872efed65ad3b %}


